# iOS Agent Guide

## Location & Layout

```
mobile/ios/juke
├── juke-iOS.xcodeproj/          # Project file used by scripts + CI
├── juke-iOS/                    # App sources (SwiftUI/UIKit, Assets.xcassets, Config)
├── juke-iOSTests/               # Unit tests
└── juke-iOSUITests/             # UI test target
```

All iOS project files now live under `mobile/ios/juke`; the former root-level `iOS/` directory has been removed.

## Toolchain

- Xcode 15+ recommended (script targets latest simulator OS).
- Swift Package Manager dependencies are embedded in the project; run `xcodebuild -resolvePackageDependencies` if needed.
- Bundle ID defaults to `embario.juke-iOS` (overridable via project settings).

## Build & Run

```bash
# Automated path (build + simulator boot + install + launch)
scripts/build_and_run_ios.sh "iPhone 17 Pro"   # optional simulator name argument

# Manual path
xed mobile/ios/juke/juke-iOS.xcodeproj          # opens Xcode
# Choose the `juke-iOS` scheme and any simulator/device, then ⌘R
```

The helper script:
1. Builds the `juke-iOS` scheme into `.derived-data` at repo root.
2. Resolves/boots the requested simulator via `xcrun simctl`.
3. Installs the Debug app bundle (`.app`).
4. Launches it using `xcrun simctl launch` and the bundle ID.

Logs from `xcodebuild` stream to `/tmp/juke-ios-build.log` for quick inspection after failures.

## Configuration Touchpoints

- API base URL: use an `xcconfig` file or `Info.plist` entry so it stays aligned with backend environments (set via `.env` for local Docker).
- OAuth redirects: coordinate with backend `SOCIAL_AUTH_SPOTIFY_*` + scheme/host in `Info.plist` (`URL Types`).
- Feature flags/settings: consolidate inside a shared Swift struct (e.g., `AppConfiguration.swift`) to keep parity with Android/web.

## Testing

- Unit tests: `juke-iOSTests` target (`⌘U` in Xcode or `xcodebuild test -scheme juke-iOS -destination "platform=iOS Simulator,name=iPhone 17 Pro"`).
- UI tests: `juke-iOSUITests` target; keep selectors resilient to design tweaks by referencing accessibility identifiers.

## Release Checklist for Agents

- Update app icons/splashes using assets generated by `scripts/export_brand_icons.sh` and commit inside `juke-iOS/Assets.xcassets`.
- Before shipping, archive via `xcodebuild -scheme juke-iOS -configuration Release -archivePath <path> archive` and export using the appropriate `.ipa` template.
- Sync version + build numbers across Info.plist, TestFlight, and the marketing site so analytics remain consistent.
